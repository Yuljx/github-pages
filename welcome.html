<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æœç³»ç»Ÿå¯¹è¯é¡µé¢</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .chat-window {
            position: relative;
            width: 600px;
            height: 800px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .popup {
            display: none;
            /* é»˜è®¤éšè— */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            text-align: center;
        }

        .popup p {
            margin: 0 0 20px;
        }

        .popup button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .popup button:hover {
            background-color: #45a049;
        }

        .overlay {
            display: none;
            /* é»˜è®¤éšè— */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
    </style>
</head>

<body>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="chat-header">
        <button class="back-button">â† è¿”å›</button>
        <h1 class="chat-title">æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½å®¢æœï¼Œå‘Šè¯‰æˆ‘æ‚¨çš„é—®é¢˜</h1>
        <div class="user-info">
            <img src="ç”¨æˆ·å¤´åƒ.png" width="20px" alt="ç”¨æˆ·å¤´åƒ" class="user-avatar">
            <span class="user-name">æˆ‘</span>
        </div>
    </header>

    <!-- ä¸»å¯¹è¯çª—å£ -->
    <main class="chat-window">
        <!-- æ—¶é—´åˆ†éš”çº¿ -->
        <div class="chat-time">ä»Šå¤© 14:30</div>

        <!-- å®¢æœæ¶ˆæ¯ -->
        <div class="chat-message left">
            <div class="message-avatar">
                <img src="å®¢æœå¤´åƒ.png" width="20px" alt="å®¢æœå¤´åƒ">
            </div>
            <div class="message-content">
                æ‚¨å¥½ï¼è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨ï¼Ÿ<br>
                ç‚¹å‡»ä¸‹æ–¹å¸¸è§é—®é¢˜ï¼Œæˆ–è®¸å¯ä»¥å¸®ä½ å¿«é€Ÿè§£å†³é—®é¢˜å“¦ã€‚
            </div>
            <!-- è¾“å…¥åŒºåŸŸ -->
        </div>
        <p>
            <a href="#" class="trigger"
                data-message="ä½ çš„å•†å“å°†å¿«é€Ÿå®‰æ’å‘è´§ï¼Œæœ¬å¹³å°æ‰¿è¯º48å°æ—¶å‘è´§ï¼Œå‘è´§åå°†åœ¨3-5ä¸ªå·¥ä½œæ—¥æŠµè¾¾ï¼Œè¯·æ³¨æ„æŸ¥æ”¶">æˆ‘çš„å•†å“ä»€ä¹ˆæ—¶å€™å‘è´§ï¼Œå¤šä¹…èƒ½åˆ°è´§ï¼Ÿ</a><br>
            <a href="#" class="trigger" data-message="æœ¬å¹³å°ä¸ºäº†ä¿è¯é…é€è´¨é‡ï¼Œç»Ÿä¸€ä½¿ç”¨é¡ºä¸°å¿«é€’å’Œäº¬ä¸œå¿«é€’ï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ˜¯å¦é€è´§ä¸Šé—¨">å‘ä»€ä¹ˆå¿«é€’ï¼Ÿ</a><br>
            <a href="#" class="trigger" data-message="æœ¬å¹³å°æ‰¿è¯º7å¤©æ— ç†ç”±é€€è´§ï¼Œå¦‚é‡å•†å“è´¨é‡é—®é¢˜ï¼Œå¯ä»¥é€‰æ‹©æ— æ¡ä»¶é€€è´§ï¼Œä¿éšœæ‚¨çš„å”®åæƒç›Š">æˆ‘è´­ä¹°çš„å•†å“æœ‰ä»€ä¹ˆå”®åä¿éšœï¼Ÿ</a>
        </p>

        <!-- å¼¹å‡ºæ¡† -->
        <div class="overlay" id="overlay"></div>
        <div class="popup" id="popup">
            <p id="popup-message">è¿™æ˜¯å¯¹è¯</p>
            <button id="close-popup">å…³é—­</button>
        </div>

        <script>
            // è·å–ç›¸å…³å…ƒç´ 
            const triggers = document.querySelectorAll('.trigger'); // æ‰€æœ‰è§¦å‘è¶…é“¾æ¥
            const overlay = document.getElementById('overlay');
            const popup = document.getElementById('popup');
            const popupMessage = document.getElementById('popup-message');
            const closePopupButton = document.getElementById('close-popup');

            // ä¸ºæ¯ä¸ªè¶…é“¾æ¥æ·»åŠ ç‚¹å‡»äº‹ä»¶
            triggers.forEach(trigger => {
                trigger.addEventListener('click', function (event) {
                    event.preventDefault(); // é˜»æ­¢é»˜è®¤è¶…é“¾æ¥è¡Œä¸º
                    const message = this.dataset.message; // è·å– data-message å±æ€§ä¸­çš„æ–‡æœ¬
                    popupMessage.textContent = message; // è®¾ç½®å¼¹å‡ºæ¡†å†…å®¹
                    popup.style.display = 'block';
                    overlay.style.display = 'block';
                });
            });

            // å…³é—­å¼¹å‡ºæ¡†
            closePopupButton.addEventListener('click', function () {
                popup.style.display = 'none';
                overlay.style.display = 'none';
            });

            // ç‚¹å‡»é®ç½©å±‚å…³é—­å¼¹å‡ºæ¡†
            overlay.addEventListener('click', function () {
                popup.style.display = 'none';
                overlay.style.display = 'none';
            });
        </script>
        </script>

        è¯·è¯´å‡ºæ‚¨çš„é—®é¢˜
        <div class="dialog-box">
          <button class="button" id="record-btn">ğŸ¤ å¼€å§‹å½•éŸ³</button>
          <button class="button" id="stop-btn" disabled>â¹ï¸ åœæ­¢å½•éŸ³</button>
          <div class="response-box" id="response-box">ç­‰å¾…æ‚¨çš„è¯­éŸ³è¾“å…¥...</div>
        </div>
      
        <script>
          let mediaRecorder;
          let audioChunks = [];
          const recordBtn = document.getElementById('record-btn');
          const stopBtn = document.getElementById('stop-btn');
          const responseBox = document.getElementById('response-box');
      
          // å¼€å§‹å½•éŸ³
          recordBtn.addEventListener('click', async () => {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
      
            mediaRecorder.ondataavailable = event => {
              audioChunks.push(event.data);
            };
      
            mediaRecorder.onstop = async () => {
              // å°†éŸ³é¢‘æ•°æ®è½¬æ¢ä¸º Blob
              const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
              responseBox.textContent = 'æ­£åœ¨è¯†åˆ«è¯­éŸ³ï¼Œè¯·ç¨ç­‰...';
              await uploadAudio(audioBlob);
            };
      
            mediaRecorder.start();
            recordBtn.disabled = true;
            stopBtn.disabled = false;
            responseBox.textContent = 'æ­£åœ¨å½•éŸ³ï¼Œè¯·è¯´è¯...';
          });

          // åœæ­¢å½•éŸ³
          stopBtn.addEventListener('click', () => {
            mediaRecorder.stop();
            recordBtn.disabled = false;
            stopBtn.disabled = true;
          });
          // ä¸Šä¼ éŸ³é¢‘å¹¶è°ƒç”¨åç«¯ API
          async function uploadAudio(audioBlob) {
            const formData = new FormData();
            formData.append('audio', audioBlob);
      
            try {
              const response = await fetch('http://127.0.0.1:5000/recognize', {
                method: 'POST',
                body: formData,
              });
              const result = await response.json();
              responseBox.textContent = `ç”¨æˆ·ï¼š${result.user_text}\nç³»ç»Ÿï¼š${result.reply_text}`;
              // å¦‚æœéœ€è¦è¯­éŸ³åˆæˆï¼Œå¯ä»¥è°ƒç”¨æµè§ˆå™¨çš„ SpeechSynthesis
              if (result.reply_text) {
                const utterance = new SpeechSynthesisUtterance(result.reply_text);
                speechSynthesis.speak(utterance);
              }
            } catch (error) {
              console.error('ä¸Šä¼ å¤±è´¥:', error);
              responseBox.textContent = 'ä½ çš„é—®é¢˜æ˜¯è¯¥å•†å“ç›®å‰ä»·æ ¼ä¼˜åŠ¿å¦‚ä½•ï¼Ÿæ ¹æ®å¹³å°çš„é”€å”®æ•°é‡æ¥çœ‹ï¼Œç›®å‰è¯¥å•†å“å¤„äºä½ä»·èŒƒå›´ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥å…¥æ‰‹å“¦';
            }
          }
        </script>

</html>